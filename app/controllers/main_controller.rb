class MainController < ApplicationController
  before_action :is_authenticated, only:[:about]

  def index
    @spaces = Space.all.order("id desc").limit(6)
    @current_user = User.find_by_id(session[:user_id])
    puts ">>>@current_user: #{@current_user.inspect}"
  end

  def show
    if params[:space_area_id] != ""
      @spaces = Space.where(country_id: params[:space_country_id], area_id: params[:space_area_id]).order("RANDOM()")
    else
      flash[:danger] = "Please select country."
      redirect_to root_path, notice: 'Please select country.'
    end
  end

  def search_filter
    puts "LOOK HERE FOR params >>>>>> #{params.inspect}"

    @spaces = Space.where(country_id: params["country_id"], area_id: params["area_id"])
    if params["space_type_id"]
      @spaces = @spaces.where(space_type_id: params["space_type_id"])
    end
    if params["vibe_id"]
      @spaces = @spaces.where(vibe_id: params["vibe_id"])
    end
    if params["amenities_ids"]
      params["amenities_ids"].each do |amenity|
        puts "amenity >>>>>>>>>>>> #{amenity}"
        # NOT WORKING YET
        @spaces = @spaces.includes(:amenities).where("spaces.amenity_id" => amenity)
      end
    end


    puts "LOOK HERE FOR SPACES FOUND >>>>>> #{@spaces.inspect}"

    render :json => @spaces
  end

end
